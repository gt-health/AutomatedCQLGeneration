// Phenotype library name
phenotype "Syphilis_Clinical_Treatment_Medication" version "1";
// # Referenced libraries #
include ClarityCore version "1.0" called Clarity;
// Termsets
// Data Entities
define final Syphilis_Clinical_Treatment_Medication:
    Clarity.CQLExecutionTask({
        "task_index": 0,
        cql: """
    library Syphilis_Clinical_Treatment_Medication version '1'
    using FHIR version '3.0.0'
    include "FHIRHelpers" version '3.0.0' called FHIRHelpers
    codesystem "SNOMED": 'http://snomed.info/sct'
    codesystem "RXNORM": 'http://www.nlm.nih.gov/research/umls/rxnorm'
    codesystem "NDC": 'http://hl7.org/fhir/sid/ndc'
    define "Patient_Retrieve": First([Patient])
    define "Syphillis_Clinical_Syphilis_Diagnosis_Concept": Concept {
    Code '76272004' from SNOMED
    }
    define "Syphillis_Clinical_Treatment_Medication_Penicillin_Concept": Concept {
    Code '7984' from RXNORM,
    Code '308351' from RXNORM
    }
    define "Syphillis_Clinical_Treatment_Medication_Ceftriaxone_Concept": Concept {
    Code '1665021' from RXNORM
    }
    context Patient
    define "Syphilis_Condition": [Condition: Code in "Syphillis_Clinical_Syphilis_Diagnosis_Concept"]
    define "Syphilis_Clinical_Treatment_Medication_Concept_Id": '2000000005'
    define "Syphilis_Clinical_Treatment_Medication_Answer_Code": 'ValueAsConcept'
    define "Syphilis_Clinical_Treatment_Medication_Penicillin_MedicationStatement": [MedicationStatement: Code in "Syphillis_Clinical_Treatment_Medication_Penicillin_Concept"]
    define "Syphilis_Clinical_Treatment_Medication_Ceftriaxone_MedicationStatement": [MedicationStatement: Code in "Syphillis_Clinical_Treatment_Medication_Ceftriaxone_Concept"]
    define "Syphilis_Clinical_Treatment_Medication_All_MedicationStatement":
      "Syphilis_Clinical_Treatment_Medication_Penicillin_MedicationStatement" union "Syphilis_Clinical_Treatment_Medication_Ceftriaxone_MedicationStatement" meds sort by effective asc
    define "First_Syphilis_Medication_Treatment": First("Syphilis_Clinical_Treatment_Medication_All_MedicationStatement")
    define "Syphilis_Clinical_Treatment_Medication_Penicillin":
    from "Syphilis_Clinical_Treatment_Medication_Penicillin_MedicationStatement" target
    return Tuple { questionConcept: '2000000005',
      sourceValue: target.medication.coding[0].code+'^'+target.medication.coding[0].system,
      answerValue: 'http://www.nlm.nih.gov/research/umls/rxnorm^7980^penicillin G',
      resultType: "MedicationStatement",
      dateTime: (target.effective as FHIR.Period).start.value
    }
    define "Syphilis_Clinical_Treatment_Medication_Ceftriaxone":
    from "Syphilis_Clinical_Treatment_Medication_Ceftriaxone_MedicationStatement" target
    return Tuple { questionConcept: '2000000005',
      sourceValue: target.medication.coding[0].code+'^'+target.medication.coding[0].system,
      answerValue: 'http://www.nlm.nih.gov/research/umls/rxnorm^2193^ceftriaxone',
      resultType: "MedicationStatement",
      dateTime: (target.effective as FHIR.Period).start.value
    }
    define "Syphilis_Clinical_Treatment_Medication":
      "Syphilis_Clinical_Treatment_Medication_Penicillin" union "Syphilis_Clinical_Treatment_Medication_Ceftriaxone"
             """
    });
